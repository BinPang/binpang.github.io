---
layout: post # 使用post模版

title:  "raft"

date:   2022-12-19

categories: algorithm

---

## 为什么
我们用客户端(C)请求服务端(S)的请求(Q)的各种情况说明为什么要这么做
C：客户端请求
S：服务器
Q：请求

我们的Q可以是任意值，例如：uid1给uid2转账2元，
### 一台服务器
C请求S失败了，那么C需要重试，当然如果有幂等情况，需要C自己保证(例如：Q=用户A给用户B转账5元，通常Q=用户A给用户B转账5元且唯一Id=唯一ID)

如果S挂了，那么服务就彻底不可用了，考虑到极端的情况：如果S所在的机房发生火灾、地震、磁盘损坏等情况，那么数据也就丢失了

### 两台服务器
当然一台服务发现S挂了，服务就会停止运行

当然2台服务器我们首先想到的就是主从结构，S1做主，S2做从。执行在S1上执行，S1讲执行的Q通过binlog的方式同步到S2
因此正常情况下Q在S1、S2上都会按照同样的顺序执行

异常情况
如果C写S1成功后，S1还未同步给S2，S1挂了，那么S1执行了，而S2未执行导致不一致

显然造成的原因是S1的binlog未能顺利同步到S2，那么比较简单了

C写S1后，S1先不给C返回，而是将binlog同步到S2，待S2确定后反馈给S1，这时S1才反馈给C

但是这里有个特别大的问题就是，如果S2挂了，那么服务是不可用的

### 3台服务器(多台)
通过前面讨论，1台&2台服务器都是满足不了的，那么
如果3台服务器，挂了一台能满足整个系统的可用性也是能满足条件的



我们在一台服务中能看到典型的就是服务器挂掉后，服务就不可用了，自然我们能想到的就是用2台机器，如果一台挂了，那么
1. 1台服务器(S)，C请求S失败了，那么C需要重试，当然如果有幂等情况，需要C自己保证(例如：Q=用户A给用户B转账5元，通常Q=用户A给用户B转账5元且唯一Id=123)
2. 1台服务器(S)，如果S挂了，那么服务不可用
3. 2台服务器主从(S1主, S2从)，C写S1(Q1)成功后返回给C成功了，S1还未同步到S2时，S1挂了，那么Q1将丢失
4. 2台服务器主从(S1主, S2从)，C写S1(Q1)后，S1同步binlog到S2，S1挂了，那么Q1将丢失
有如下业务场景
```
client ----> server
```